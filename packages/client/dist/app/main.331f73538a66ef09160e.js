(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{54:function(e,t,a){},85:function(e,t){},88:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(8),o=a.n(c),s=(a(54),a(4)),i=a(12),l=a(43),m=a.n(l),u=a(44),d=a.n(u),h=a(2),g=a.n(h),p=a(45),E=a.n(p);function f(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function b(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(Object(a),!0).forEach((function(t){E()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var v,_,w={accessToken:null,name:null,chatRooms:[],toggledChatId:null},y=function(e,t){switch(t.type){case"UPDATE_ACCESS_TOKEN":return b({},e,{accessToken:t.accessToken});case"UPDATE_NAME":return b({},e,{name:t.name});case"UPDATE_CHAT_ROOMS":return b({},e,{chatRooms:t.chatRooms});case"UPDATE_TOGGLED_CHAT_ID":return b({},e,{toggledChatId:t.toggledChatId});default:throw new Error("Unhandled action type")}},O=Object(n.createContext)({state:w,dispatch:function(){}}),N=function(e){var t=Object(n.useReducer)(y,w),a=g()(t,2),c=a[0],o=a[1];return r.a.createElement(O.Provider,{value:{state:c,dispatch:o}},e.children)},C=function(){return Object(n.useContext)(O)},x=function(e){var t=e.children,a=d()(e,["children"]),n=C().state;return r.a.createElement(i.b,m()({},a,{render:function(e){var a=e.location;return n.accessToken?t:r.a.createElement(i.a,{to:"/access?target=".concat(encodeURI(a.pathname+a.search))})}}))},k="CenteredLayout-container",j=function(e){return r.a.createElement("main",{className:k},e.children)},M="EnteranceHeader-header",S="EnteranceHeader-header__title",R="EnteranceHeader-header__text",T=function(e){return r.a.createElement("section",{className:M},r.a.createElement("h1",{className:S},e.title),r.a.createElement("span",{className:R},e.text))},A=a(1),I=a.n(A),L=a(5),P=a.n(L),D=a(11),B="LoginForm-form",U="LoginForm-form__error",z="FormInput-field",F="FormInput-field__input",H="FormInput-field__input--error",q="FormInput-field__error",V=function(e){return r.a.createElement("section",{className:z},r.a.createElement("input",{name:e.name,type:e.type,placeholder:e.placeholder,className:e.error?F+" "+H:F,ref:e.register}),e.error&&r.a.createElement("span",{className:q},e.error))},G="DefaultButton-button",J="DefaultButton-button--primary",K="DefaultButton-button--disabled",Y="DefaultButton-button__spinner",$="DefaultButton-button__spinner--primary",Q=function(e){var t=G;e.isPrimary&&(t+=" "+J),e.isDisabled&&(t+=" "+K);var a=e.width?{width:e.width+"px"}:{};return r.a.createElement("button",{type:e.type,disabled:e.isDisabled||e.isLoading,onClick:e.onClick,className:t,style:a},e.isLoading?r.a.createElement("div",{className:e.isPrimary?Y+" "+$:Y}):e.text)},W="FormSwitchLink-link",X=function(e){return r.a.createElement(s.b,{to:e.href,className:W},e.text)},Z=function(){var e=Object(n.useState)(!1),t=g()(e,2),a=t[0],c=t[1],o=Object(n.useState)(),s=g()(o,2),l=s[0],m=s[1],u=Object(D.a)({mode:"onBlur"}),d=u.register,h=u.handleSubmit,p=u.errors,E=Object(i.g)(),f=C().dispatch,b=function(){var e=P()(I.a.mark((function e(t){var a,n;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m(""),c(!0),e.prev=2,e.next=5,fetch("/api/auth/login",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)});case 5:return a=e.sent,e.next=8,a.json();case 8:(n=e.sent).ok&&n.UAT?(c(!1),f({type:"UPDATE_ACCESS_TOKEN",accessToken:n.UAT}),f({type:"UPDATE_NAME",name:t.name}),E.push("/home")):n.message?(c(!1),m(n.message)):(c(!1),m("Something went wrong :(")),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),c(!1),m(e.t0.message);case 16:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("form",{className:B,onSubmit:h(b)},l&&r.a.createElement("span",{className:U},l),r.a.createElement(V,{placeholder:"Name",name:"name",type:"text",error:p.name?p.name.message:"",register:d({required:"Name is required"})}),r.a.createElement(V,{placeholder:"Password",name:"password",type:"password",error:p.password?p.password.message:"",register:d({required:"Password is required"})}),r.a.createElement(Q,{type:"submit",text:"Login",isLoading:a,isPrimary:!0}),r.a.createElement(X,{href:"/register",text:"Register an account"}))},ee=function(){return r.a.createElement(j,null,r.a.createElement(T,{title:"Login to account",text:"Please, login to your account to use chat"}),r.a.createElement(Z,null))},te="RegisterForm-form",ae="RegisterForm-form__error",ne=function(){var e=Object(n.useState)(!1),t=g()(e,2),a=t[0],c=t[1],o=Object(n.useState)(),s=g()(o,2),l=s[0],m=s[1],u=Object(D.a)({mode:"onChange"}),d=u.register,h=u.handleSubmit,p=u.errors,E=u.watch,f=Object(i.g)(),b=C().dispatch,v=function(){var e=P()(I.a.mark((function e(t){var a,n;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m(""),c(!0),e.prev=2,e.next=5,fetch("/api/auth/register",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({name:t.name,password:t.password})});case 5:return a=e.sent,e.next=8,a.json();case 8:(n=e.sent).ok&&n.UAT?(c(!1),b({type:"UPDATE_ACCESS_TOKEN",accessToken:n.UAT}),b({type:"UPDATE_NAME",name:t.name}),f.push("/home")):n.message?(c(!1),m(n.message.split("Error: ")[1])):(c(!1),m("Something went wrong :(")),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),c(!1),m(e.t0.message);case 16:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("form",{className:te,onSubmit:h(v)},l&&r.a.createElement("span",{className:ae},l),r.a.createElement(V,{placeholder:"Choose name",name:"name",type:"text",error:p.name?p.name.message:"",register:d({required:"Name is required",minLength:{value:2,message:"Min length is 2 characters"},maxLength:{value:16,message:"Max length is 16 characters"},pattern:{value:/^\w+$/i,message:"Only characters and underscores availibale"}})}),r.a.createElement(V,{placeholder:"Choose password",name:"password",type:"password",error:p.password?p.password.message:"",register:d({required:"Password is required",minLength:{value:4,message:"Min length is 4 characters"}})}),r.a.createElement(V,{placeholder:"Repeat password",name:"repeatedPassword",type:"password",error:p.repeatedPassword?p.repeatedPassword.message:"",register:d({required:"Please, repeat the password",validate:function(e){return e===E("password")||"Passwords don't match"}})}),r.a.createElement(Q,{type:"submit",text:"Register",isLoading:a,isPrimary:!0}),r.a.createElement(X,{href:"/login",text:"Login to account"}))},re=function(){return r.a.createElement(j,null,r.a.createElement(T,{title:"Register an account",text:"Please, register an account to use chat"}),r.a.createElement(ne,null))},ce="RedirectMessage-message",oe="RedirectMessage-message__title",se="RedirectMessage-message__text",ie="RedirectMessage-message__path",le=function(e){return r.a.createElement("section",{className:ce},r.a.createElement("h1",{className:oe},e.title),r.a.createElement("span",{className:se},e.text),r.a.createElement("span",{className:ie},e.path))},me=function(){return new URLSearchParams(Object(i.h)().search)},ue=function(){var e=Object(i.g)(),t=me(),a=C().dispatch,c=decodeURI(t.get("target"));return("null"===c||["/login","/register","/access"].includes(c))&&(c="/home"),Object(n.useEffect)((function(){(function(){var t=P()(I.a.mark((function t(){var n,r;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("/api/auth/authenticate",{method:"POST",credentials:"include"});case 3:return n=t.sent,t.next=6,n.json();case 6:(r=t.sent).ok&&r.UAT&&r.name?(a({type:"UPDATE_ACCESS_TOKEN",accessToken:r.UAT}),a({type:"UPDATE_NAME",name:r.name}),e.push(c)):e.push("/login"),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(0),console.error(t.t0),e.push("/login");case 14:case"end":return t.stop()}}),t,null,[[0,10]])})));return function(){return t.apply(this,arguments)}})()()}),[]),r.a.createElement(j,null,r.a.createElement(le,{title:"Authenticating",text:"You will be redirected to:",path:c}))},de=function(){var e=Object(i.g)(),t=Object(i.h)().pathname;return r.a.createElement(j,null,r.a.createElement(le,{title:"Error 404 :(",text:"No match found for:",path:t}),r.a.createElement(Q,{type:"button",text:"Go to homepage",onClick:function(){return e.push("/home")},width:240,isPrimary:!0}))},he="MainLayout-container",ge="MainLayout-header",pe="MainLayout-aside",Ee="MainLayout-main",fe="MainLayout-main--blank",be="MainLayout-main--blank__button",ve="ChatRoomListModal-modal",_e="ChatRoomListModal-modal__aside",we="ModalOverlay-overlay",ye=r.a.memo((function(e){return r.a.createElement("div",{className:we,onClick:e.onClick})})),Oe=function(e){return e.isShowing?Object(c.createPortal)(r.a.createElement(r.a.Fragment,null,r.a.createElement(ye,{onClick:e.hide}),r.a.createElement("div",{className:ve,"aria-modal":!0,"aria-hidden":!0,tabIndex:-1,role:"dialog"},r.a.createElement("aside",{className:_e},e.children))),document.body):null},Ne="ShowChatRoomListButton-button",Ce="ShowChatRoomListButton-button__icon",xe=Object(n.memo)((function(e){return r.a.createElement("button",{type:"button",title:"Show chat room list",className:Ne,onClick:e.onClick},r.a.createElement("svg",{className:Ce,viewBox:"0 0 512.007 512.007"},r.a.createElement("path",{d:"M482.004 182h-301c-16.542 0-30 13.458-30 30v210c0 16.542 13.458 30 30 30h248.859l56.622 55.694c9.442 9.287 25.519 2.591 25.519-10.694V212c0-16.542-13.458-30-30-30zm-46 209h-210c-8.284 0-15-6.716-15-15s6.716-15 15-15h210c8.284 0 15 6.716 15 15s-6.716 15-15 15zm-225-75c0-8.284 6.716-15 15-15h150c8.284 0 15 6.716 15 15s-6.716 15-15 15h-150c-8.285 0-15-6.716-15-15zm225-45h-210c-8.284 0-15-6.716-15-15s6.716-15 15-15h210c8.284 0 15 6.716 15 15s-6.716 15-15 15z"}),r.a.createElement("path",{d:"M361.004 152V30c0-16.54-13.46-30-30-30h-301c-16.54 0-30 13.46-30 30v285c0 13.352 16.13 19.949 25.52 10.69L82.144 270h38.86v-58c0-33.084 26.916-60 60-60zm-75-1c-8.284 0-15-6.716-15-15s6.716-15 15-15 15 6.716 15 15-6.716 15-15 15zm-210-90h210c8.284 0 15 6.716 15 15s-6.716 15-15 15h-210c-8.284 0-15-6.716-15-15s6.715-15 15-15zm30 150h-30c-8.284 0-15-6.716-15-15s6.716-15 15-15h30c8.284 0 15 6.716 15 15s-6.716 15-15 15zm-30-60c-8.284 0-15-6.716-15-15s6.716-15 15-15h150c8.284 0 15 6.716 15 15s-6.716 15-15 15z"})))})),ke="ChatRoomList-chat-room-list",je="ChatRoomList-chat-room-list__title",Me="ChatRoomList-chat-room-list__blank",Se=Object(n.memo)((function(e){return r.a.createElement("section",{className:ke},r.a.createElement("h3",{className:je},"Your chat rooms"),e.children?e.children:r.a.createElement("span",{className:Me},"You have no chats yet"))})),Re="ChatRoomItem-chat-room-item",Te="ChatRoomItem-chat-room-item--toggled",Ae="ChatRoomItem-chat-room-item__icon",Ie="ChatRoomItem-chat-room-item__name",Le=function(e){var t=Object(n.useState)(e.isToggled),a=g()(t,2),c=a[0],o=a[1],i=C().state;Object(n.useEffect)((function(){i.toggledChatId===e.id?o(!0):o(!1)}));var l=c?Re+" "+Te:Re;return r.a.createElement(s.b,{to:"/chat/".concat(e.id),className:l},r.a.createElement("svg",{className:Ae,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},r.a.createElement("g",{"data-name":"message-square"},r.a.createElement("rect",{width:"24",height:"24",opacity:"0"}),r.a.createElement("path",{d:"M19 3H5a3 3 0 0 0-3 3v15a1 1 0 0 0 .51.87A1 1 0 0 0 3 22a1 1 0 0 0 .51-.14L8 19.14a1 1 0 0 1 .55-.14H19a3 3 0 0 0 3-3V6a3 3 0 0 0-3-3zM8 12a1 1 0 1 1 1-1 1 1 0 0 1-1 1zm4 0a1 1 0 1 1 1-1 1 1 0 0 1-1 1zm4 0a1 1 0 1 1 1-1 1 1 0 0 1-1 1z"}))),r.a.createElement("span",{className:Ie},e.name))},Pe="AddChatRoomButton-add-chat-room",De="AddChatRoomButton-add-chat-room__icon",Be="AddChatRoomModal-overlay",Ue="AddChatRoomModal-modal",ze="AddChatRoomModal-modal__container",Fe="AddChatRoomModal-container__title",He="AddChatRoomForm-form",qe="AddChatRoomForm-form__error",Ve=function(e){var t=Object(n.useState)(!1),a=g()(t,2),c=a[0],o=a[1],s=Object(n.useState)(),l=g()(s,2),m=l[0],u=l[1],d=Object(D.a)({mode:"onBlur"}),h=d.register,p=d.handleSubmit,E=d.errors,f=Object(i.g)(),b=C(),v=b.state,_=b.dispatch,w=function(){var t=P()(I.a.mark((function t(a){var n,r,c;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u(""),o(!0),t.prev=2,t.next=5,fetch("/api/chat_rooms/new",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json;charset=utf-8",authorization:"Bearer ".concat(v.accessToken)},body:JSON.stringify(a)});case 5:return n=t.sent,t.next=8,n.json();case 8:(r=t.sent).ok&&r.chatId?(c=v.chatRooms.concat([{id:r.chatId,name:a.name}]),_({type:"UPDATE_CHAT_ROOMS",chatRooms:c}),_({type:"UPDATE_TOGGLED_CHAT_ID",toggledChatId:r.chatId}),f.push("/chat/".concat(r.chatId)),e.hide(null)):r.message?(o(!1),u(r.message)):(o(!1),u("Something went wrong :(")),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(2),o(!1),u(t.t0.message);case 16:case"end":return t.stop()}}),t,null,[[2,12]])})));return function(e){return t.apply(this,arguments)}}();return r.a.createElement("form",{className:He,onSubmit:p(w)},m&&r.a.createElement("span",{className:qe},m),r.a.createElement(V,{placeholder:"Name",name:"name",type:"text",error:E.name?E.name.message:"",register:h({required:"Name is required"})}),r.a.createElement(Q,{type:"submit",text:"Create",isLoading:c,isPrimary:!0}))},Ge=function(e){return e.isShowing?Object(c.createPortal)(r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:Be,onClick:e.hide}),r.a.createElement("div",{className:Ue,"aria-modal":!0,"aria-hidden":!0,tabIndex:-1,role:"dialog"},r.a.createElement("div",{className:ze},r.a.createElement("h2",{className:Fe},"Choose name for new chat"),r.a.createElement(Ve,{hide:e.hide})))),document.body):null},Je=function(){var e=Object(n.useState)(!1),t=g()(e,2),a=t[0],r=t[1];return{isShowing:a,toggle:function(){r(!a)}}},Ke=Object(n.memo)((function(){var e=Je(),t=e.isShowing,a=e.toggle;return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{type:"button",title:"Add new chat room",className:Pe,onClick:a},r.a.createElement("svg",{className:De,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},r.a.createElement("g",{"data-name":"plus"},r.a.createElement("rect",{width:"24",height:"24",transform:"rotate(180 12 12)",opacity:"0"}),r.a.createElement("path",{d:"M19 11h-6V5a1 1 0 0 0-2 0v6H5a1 1 0 0 0 0 2h6v6a1 1 0 0 0 2 0v-6h6a1 1 0 0 0 0-2z"})))),r.a.createElement(Ge,{isShowing:t,hide:a}))})),Ye=function(){var e=C().state;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Se,null,e.chatRooms.length>0&&e.chatRooms.map((function(t){return r.a.createElement(Le,{key:t.name,id:t.id,name:t.name,isToggled:t.id===e.toggledChatId})}))),r.a.createElement(Ke,null))},$e=function(){var e=C(),t=e.state,a=e.dispatch;return Object(n.useEffect)((function(){(function(){var e=P()(I.a.mark((function e(){var n,r;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/chat_rooms/",{method:"GET",credentials:"include",headers:{authorization:"Bearer ".concat(t.accessToken)}});case 3:return n=e.sent,e.next=6,n.json();case 6:(r=e.sent).ok?a({type:"UPDATE_CHAT_ROOMS",chatRooms:r.chatRooms}):window.alert(r.message),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}})()()}),[]),r.a.createElement(Ye,null)},Qe="UserFigure-user",We="UserFigure-user__avatar",Xe="UserFigure-avatar__label",Ze="UserFigure-user__name",et=r.a.memo((function(e){return r.a.createElement("figure",{className:Qe},r.a.createElement("div",{className:We},r.a.createElement("div",{className:Xe},e.name[0])),r.a.createElement("figcaption",{className:Ze},e.name))})),tt="LogoutButton-button",at="LogoutButton-button__icon",nt=function(e){return r.a.createElement("button",{type:"button",title:"Logout",className:tt,onClick:e.onClick},r.a.createElement("svg",{viewBox:"0 0 24 24",className:at},r.a.createElement("g",{"data-name":"logout"},r.a.createElement("rect",{width:"24",height:"24",transform:"rotate(-90 12 12)",opacity:"0"}),r.a.createElement("path",{d:"M19 4h-2a1 1 0 0 0 0 2h1v12h-1a1 1 0 0 0 0 2h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1z"}),r.a.createElement("path",{d:"M11.8 7.4a1 1 0 0 0-1.6 1.2L12 11H4a1 1 0 0 0 0 2h8.09l-1.72 2.44a1 1 0 0 0 .24 1.4 1 1 0 0 0 .58.18 1 1 0 0 0 .81-.42l2.82-4a1 1 0 0 0 0-1.18z"}))))},rt=Object(n.memo)((function(){var e=C().dispatch,t=Object(i.g)(),a=function(){var a=P()(I.a.mark((function a(){var n,r;return I.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,fetch("/api/auth/logout",{method:"POST",credentials:"include"});case 3:return n=a.sent,a.next=6,n.json();case 6:(r=a.sent).ok?(e({type:"UPDATE_ACCESS_TOKEN",accessToken:null}),e({type:"UPDATE_NAME",name:null}),e({type:"UPDATE_TOGGLED_CHAT_ID",toggledChatId:null}),t.push("/login")):window.alert(r.message),a.next=13;break;case 10:a.prev=10,a.t0=a.catch(0),console.error(a.t0);case 13:case"end":return a.stop()}}),a,null,[[0,10]])})));return function(){return a.apply(this,arguments)}}();return r.a.createElement(nt,{onClick:a})})),ct=function(e){var t=C().state,a=Je(),n=a.isShowing,c=a.toggle;return r.a.createElement("div",{className:he},r.a.createElement("header",{className:ge},r.a.createElement(xe,{onClick:c}),r.a.createElement(Oe,{isShowing:n,hide:c},r.a.createElement($e,null)),r.a.createElement(et,{name:t.name}),r.a.createElement(rt,null)),r.a.createElement("aside",{className:pe},r.a.createElement($e,null)),e.main?r.a.createElement("main",{className:Ee},e.main):r.a.createElement("main",{className:fe},"Please, choose a chat room or create a new one.",r.a.createElement("section",{className:be},r.a.createElement(Ke,null))))},ot=function(){return r.a.createElement(ct,null)},st="DefaultMessage-message",it="DefaultMessage-message__title",lt="DefaultMessage-message__text",mt=function(e){return r.a.createElement("section",{className:st},r.a.createElement("h1",{className:it},e.title),r.a.createElement("span",{className:lt},e.text))},ut=function(){var e=Object(i.g)(),t=me(),a=decodeURI(t.get("message"));return"null"===a&&(a="No message."),r.a.createElement(j,null,r.a.createElement(mt,{title:"Failed to join chat :(",text:a}),r.a.createElement(Q,{type:"button",text:"Go to homepage",onClick:function(){return e.push("/home")},width:240,isPrimary:!0}))},dt=a(48),ht=a.n(dt),gt=a(29),pt=a.n(gt),Et=a(20),ft=a.n(Et),bt="ChatRoom-container",vt="ChatRoom-header",_t="ChatRoom-main",wt="ChatRoom-main__video",yt="ChatRoom-main__messages",Ot="ChatRoom-form",Nt="ShowMembersButton-button",Ct="ShowMembersButton-button__icon",xt=Object(n.memo)((function(e){return r.a.createElement("button",{type:"button",title:"Show online participants",className:Nt,onClick:e.onClick},r.a.createElement("svg",{viewBox:"0 0 24 24",className:Ct},r.a.createElement("g",{"data-name":"people"},r.a.createElement("rect",{width:"24",height:"24",opacity:"0"}),r.a.createElement("path",{d:"M9 11a4 4 0 1 0-4-4 4 4 0 0 0 4 4z"}),r.a.createElement("path",{d:"M17 13a3 3 0 1 0-3-3 3 3 0 0 0 3 3z"}),r.a.createElement("path",{d:"M21 20a1 1 0 0 0 1-1 5 5 0 0 0-8.06-3.95A7 7 0 0 0 2 20a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1"}))))})),kt="CopyJoinLinkButton-button",jt="CopyJoinLinkButton-button__icon",Mt="JoinLinkModal-overlay",St="JoinLinkModal-modal",Rt="JoinLinkModal-modal__container",Tt="JoinLinkModal-container__title",At=function(e){return e.isShowing?Object(c.createPortal)(r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:Mt,onClick:e.hide}),r.a.createElement("div",{className:St,"aria-modal":!0,"aria-hidden":!0,tabIndex:-1,role:"dialog"},r.a.createElement("div",{className:Rt},r.a.createElement("h2",{className:Tt},"Chat join link copied to clipboard!")))),document.body):null},It=Object(n.memo)((function(e){var t=Je(),a=t.isShowing,n=t.toggle,c=function(){var t=P()(I.a.mark((function t(){return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.clipboard.writeText("https://localhost:5000/api/chat_rooms/join/".concat(e.chatToken));case 2:n();case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{type:"button",title:"Copy join chat link",className:kt,onClick:function(){return c()}},r.a.createElement("svg",{viewBox:"0 0 24 24",className:jt},r.a.createElement("g",{"data-name":"copy"},r.a.createElement("rect",{width:"24",height:"24",opacity:"0"}),r.a.createElement("path",{d:"M18 9h-3V5.67A2.68 2.68 0 0 0 12.33 3H5.67A2.68 2.68 0 0 0 3 5.67v6.66A2.68 2.68 0 0 0 5.67 15H9v3a3 3 0 0 0 3 3h6a3 3 0 0 0 3-3v-6a3 3 0 0 0-3-3zm-9 3v1H5.67a.67.67 0 0 1-.67-.67V5.67A.67.67 0 0 1 5.67 5h6.66a.67.67 0 0 1 .67.67V9h-1a3 3 0 0 0-3 3z"})))),r.a.createElement(At,{isShowing:a,hide:n}))})),Lt="MessageInput-field",Pt="MessageInput-field__input",Dt="MessageInput-field__input--error",Bt=function(e){return r.a.createElement("section",{className:Lt},r.a.createElement("input",{name:"message",type:"text",placeholder:"Enter your message",className:e.error?Pt+" "+Dt:Pt,ref:e.register}))},Ut="SendMessageButton-button",zt="SendMessageButton-button--disabled",Ft="SendMessageButton-button__spinner",Ht="SendMessageButton-button__icon",qt=function(e){var t=e.isDisabled?Ut+" "+zt:Ut;return r.a.createElement("button",{type:"submit",disabled:e.isDisabled||e.isLoading,onClick:e.onClick,className:t},e.isLoading?r.a.createElement("div",{className:Ft}):r.a.createElement("svg",{className:Ht,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},r.a.createElement("g",{"data-name":"paper-plane"},r.a.createElement("rect",{width:"24",height:"24",opacity:"0"}),r.a.createElement("path",{d:"M21 4a1.31 1.31 0 0 0-.06-.27v-.09a1 1 0 0 0-.2-.3 1 1 0 0 0-.29-.19h-.09a.86.86 0 0 0-.31-.15H20a1 1 0 0 0-.3 0l-18 6a1 1 0 0 0 0 1.9l8.53 2.84 2.84 8.53a1 1 0 0 0 1.9 0l6-18A1 1 0 0 0 21 4zm-4.7 2.29l-5.57 5.57L5.16 10zM14 18.84l-1.86-5.57 5.57-5.57z"}))))},Vt="MembersModal-modal",Gt="MembersModal-modal__aside",Jt=function(e){return e.isShowing?Object(c.createPortal)(r.a.createElement(r.a.Fragment,null,r.a.createElement(ye,{onClick:e.hide}),r.a.createElement("div",{className:Vt,"aria-modal":!0,"aria-hidden":!0,tabIndex:-1,role:"dialog"},r.a.createElement("aside",{className:Gt},e.children))),document.body):null},Kt=a(49),Yt="MessagesList-messages__list",$t={message:"MessageItem-message","message--owned":"MessageItem-message--owned",messageOwned:"MessageItem-message--owned",message__avatar:"MessageItem-message__avatar",avatar__label:"MessageItem-avatar__label",message__content:"MessageItem-message__content",content__text:"MessageItem-content__text","content__text--owned":"MessageItem-content__text--owned",content__textOwned:"MessageItem-content__text--owned",content__date:"MessageItem-content__date"},Qt=function(e){var t=e.isOwned?$t.message+" "+$t.messageOwned:$t.message;return r.a.createElement("section",{className:t},r.a.createElement("div",{className:$t.message__avatar},r.a.createElement("div",{className:$t.avatar__label},e.name[0])),r.a.createElement("section",{className:e.isOwned?$t.message__content+" "+$t.message__contentOwned:$t.message__content},r.a.createElement("section",{className:e.isOwned?$t.content__text+" "+$t.content__textOwned:$t.content__text},e.text),r.a.createElement("section",{className:$t.content__date},e.createdAt)))},Wt=function(e){var t=C().state,a=Object(n.useRef)(null),c=Object(n.useRef)(null),o=Object(Kt.a)(a).stayScrolled;return Object(n.useLayoutEffect)((function(){c.current.scrollIntoView({behavior:"smooth"})}),[]),Object(n.useLayoutEffect)((function(){null!==a.current&&o()}),[e.messages.length]),r.a.createElement("section",{className:Yt,ref:a},e.messages.map((function(e){return r.a.createElement(Qt,{key:e.senderName+e.createdAt,name:e.senderName,text:e.text,createdAt:e.createdAt,isOwned:e.senderName===t.name})})),r.a.createElement("div",{ref:c}))},Xt="StreamActionButton-stream-action",Zt="StreamActionButton-stream-action__icon",ea=function(e){return r.a.createElement("button",{type:"button",title:e.isStreaming?"Stop streaming":"Start streaming",className:Xt,onClick:e.onClick},e.isStreaming?r.a.createElement("svg",{className:Zt,viewBox:"0 0 24 24"},r.a.createElement("g",{"data-name":"video-off"},r.a.createElement("rect",{width:"24",height:"24",opacity:"0"}),r.a.createElement("path",{d:"M14.22 17.05L4.88 7.71 3.12 6 3 5.8A3 3 0 0 0 2 8v8a3 3 0 0 0 3 3h9a2.94 2.94 0 0 0 1.66-.51z"}),r.a.createElement("path",{d:"M21 7.15a1.7 1.7 0 0 0-1.85.3l-2.15 2V8a3 3 0 0 0-3-3H7.83l1.29 1.29 6.59 6.59 2 2 2 2a1.73 1.73 0 0 0 .6.11 1.68 1.68 0 0 0 .69-.15 1.6 1.6 0 0 0 1-1.48V8.63a1.6 1.6 0 0 0-1-1.48z"}),r.a.createElement("path",{d:"M17 15.59l-2-2L8.41 7l-2-2-1.7-1.71a1 1 0 0 0-1.42 1.42l.54.53L5.59 7l9.34 9.34 1.46 1.46 2.9 2.91a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.42z"}))):r.a.createElement("svg",{className:Zt,viewBox:"0 0 24 24"},r.a.createElement("g",{"data-name":"video"},r.a.createElement("rect",{width:"24",height:"24",opacity:"0"}),r.a.createElement("path",{d:"M21 7.15a1.7 1.7 0 0 0-1.85.3l-2.15 2V8a3 3 0 0 0-3-3H5a3 3 0 0 0-3 3v8a3 3 0 0 0 3 3h9a3 3 0 0 0 3-3v-1.45l2.16 2a1.74 1.74 0 0 0 1.16.45 1.68 1.68 0 0 0 .69-.15 1.6 1.6 0 0 0 1-1.48V8.63A1.6 1.6 0 0 0 21 7.15z"}))))},ta=function(e){var t=Object(n.useState)(!1),a=g()(t,2),c=a[0],o=a[1],s=Object(D.a)({mode:"onSubmit"}),i=s.handleSubmit,l=s.register,m=s.errors,u=s.reset,d=C().state,h=Je(),p=h.isShowing,E=h.toggle,f=function(){e.videoRef.current.srcObject&&(e.videoRef.current.srcObject.getTracks().forEach((function(e){return e.stop()})),e.videoRef.current.srcObject=null,o(!1))};return Object(n.useEffect)((function(){return function(){return f()}}),[e.chatRoom.id]),r.a.createElement("article",{className:bt},r.a.createElement("header",{className:vt},r.a.createElement(It,{chatToken:e.chatRoom.token}),r.a.createElement("h4",null,e.chatRoom.name),r.a.createElement(xt,{onClick:E}),r.a.createElement(Jt,{isShowing:p,hide:E},r.a.createElement("h3",null,"Online participants"),e.members.length?e.members.map((function(e){return r.a.createElement(r.a.Fragment,null,e.socketId&&r.a.createElement(et,{name:e.name}))})):"No members yet")),r.a.createElement("main",{className:_t},r.a.createElement("section",{className:wt},r.a.createElement("video",{autoPlay:!0,style:{width:280,height:200},ref:e.videoRef}),e.chatRoom.owner.name===d.name&&r.a.createElement(r.a.Fragment,null,c?r.a.createElement(ea,{onClick:f,isStreaming:!0}):r.a.createElement(ea,{onClick:function(){o(!0),e.startStreaming()}}))),r.a.createElement("section",{className:yt},e.messages.length?r.a.createElement(Wt,{messages:e.messages}):"No messages yet")),r.a.createElement("form",{className:Ot,onSubmit:i((function(t){e.socket.emit("message",{chatRoomId:e.chatRoom.id,senderName:d.name,text:t.message,createdAt:ft()().format("DD MMMM HH:mm")}),u()}))},r.a.createElement(Bt,{error:m.message?m.message.message:"",register:l({required:"Message cannot be empty",maxLength:{value:200,message:"Max length is 200 characters"}})}),r.a.createElement(qt,null)))},aa={iceServers:[{urls:["stun:stun.l.google.com:19302"]}]},na={},ra=function(e){var t=Object(n.useState)(null),a=g()(t,2),c=a[0],o=a[1],s=Object(n.useState)(),i=g()(s,2),l=i[0],m=i[1],u=Object(n.useState)([]),d=g()(u,2),h=d[0],p=d[1],E=Object(n.useState)([]),f=g()(E,2),b=f[0],w=f[1],y=C(),O=y.state,N=y.dispatch,x=Object(n.useRef)();Object(n.useEffect)((function(){return _=pt()(),function(){x.current.srcObject&&(x.current.srcObject.getTracks().forEach((function(e){return e.stop()})),x.current.srcObject=null);_.close()}}),[]),Object(n.useEffect)((function(){return N({type:"UPDATE_TOGGLED_CHAT_ID",toggledChatId:e.chatId}),function(){var t=P()(I.a.mark((function t(){var a,n,r;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("/api/chat_rooms/".concat(e.chatId),{method:"GET",credentials:"include",headers:{authorization:"Bearer ".concat(O.accessToken)}});case 3:return a=t.sent,t.next=6,a.json();case 6:(n=t.sent).ok&&n.chatRoom?(m(n.chatRoom),n.chatRoom.messages&&n.chatRoom.messages.length?(r=n.chatRoom.messages.map((function(e){return{chatRoomId:n.chatRoom.id,senderName:e.sender.name,text:e.text,createdAt:ft()(e.created_at).format("DD MMMM HH:mm")}})),w(r),pt.a.connect("https://localhost:5000"),n.chatRoom.owner.name!==O.name&&(window.onunload=window.onbeforeunload=function(){_.close()},_.on("offer",(function(e,t){(v=new RTCPeerConnection(aa)).setRemoteDescription(t).then((function(){return v.createAnswer()})).then((function(e){return v.setLocalDescription(e)})).then((function(){_.emit("answer",e,v.localDescription)})),v.ontrack=function(e){x.current.srcObject=e.streams[0]},v.onicecandidate=function(t){t.candidate&&_.emit("candidate",e,t.candidate)}})),_.on("candidate",(function(e,t){v.addIceCandidate(new RTCIceCandidate(t)).catch((function(e){return console.error(e)}))})),_.on("connect",(function(){_.emit("watcher")})),_.on("broadcaster",(function(){_.emit("watcher")})),_.on("bye",(function(){v.close()})))):w([]),_.emit("join",{room:n.chatRoom.id,name:O.name},(function(e){e&&console.log(e)})),console.log(h),_.on("join",(function(t){var a=t.name,n=t.activeUsers;console.log(a+" joined");var r=n.filter((function(t){return t.room===e.chatId}));p(r)})),_.on("exit",(function(t){var a=t.name,n=t.activeUsers;console.log(a+" exited");var r=n.filter((function(t){return t.room===e.chatId}));p(r)})),_.on("remove-user",(function(e){var t=e.socketId,a=h.map((function(e){return e.socketId===t&&(e.socketId=void 0),e}));p(a)}))):o(n.message),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),console.error(t.t0);case 13:case"end":return t.stop()}}),t,null,[[0,10]])})));return function(){return t.apply(this,arguments)}}()(),function(){_.emit("exit",{room:e.chatId,name:O.name},(function(e){e&&console.log(e)}))}}),[e.chatId]),Object(n.useEffect)((function(){_.on("message",(function(e){w([].concat(ht()(b),[e]))}))}),[b]);return r.a.createElement(r.a.Fragment,null,l?r.a.createElement(ta,{chatRoom:l,members:h,messages:b,socket:_,videoRef:x,startStreaming:function(){navigator.mediaDevices.getUserMedia({audio:!0,video:{facingMode:"user"}}).then((function(e){x.current.srcObject=e,_.emit("broadcaster")})).catch((function(e){return console.error(e)})),_.on("answer",(function(e,t){na[e].setRemoteDescription(t)})),_.on("watcher",(function(e){var t=new RTCPeerConnection(aa);na[e]=t;var a=x.current.srcObject;a.getTracks().forEach((function(e){return t.addTrack(e,a)})),t.createOffer().then((function(e){return t.setLocalDescription(e)})).then((function(){_.emit("offer",e,t.localDescription)})),t.onicecandidate=function(t){t.candidate&&_.emit("candidate",e,t.candidate)}}))}}):r.a.createElement("h2",null,c))},ca=function(){var e=Object(i.i)().id,t=parseInt(e),a=void 0;return t&&(a=r.a.createElement(ra,{chatId:t})),r.a.createElement(ct,{main:a})},oa=function(){return r.a.createElement(s.a,null,r.a.createElement(i.d,null,r.a.createElement(i.b,{path:"/login"},r.a.createElement(ee,null)),r.a.createElement(i.b,{path:"/register"},r.a.createElement(re,null)),r.a.createElement(i.b,{path:"/access"},r.a.createElement(ue,null)),r.a.createElement(x,{path:"/home"},r.a.createElement(ot,null)),r.a.createElement(x,{path:"/chat/:id"},r.a.createElement(ca,null)),r.a.createElement(i.b,{path:"/join_failed"},r.a.createElement(ut,null)),r.a.createElement(i.b,{path:"/",exact:!0,render:function(){return r.a.createElement(i.a,{to:{pathname:"/home"}})}}),r.a.createElement(i.b,{path:"*"},r.a.createElement(de,null))))},sa=function(){return r.a.createElement(N,null,r.a.createElement(oa,null))};o.a.render(r.a.createElement(sa,null),document.getElementById("root"))}},[[88,1,2]]]);